# Тестовое задание

Решение включает в себя систему валидации email-адресов, скрипт автоматизированной рассылки уведомлений в Telegram и описание архитектуры для масштабирования системы.

---

## 1. Инструкция по запуску

### Подготовка
1. Установите зависимости:
```bash
   pip install -r requirements.txt
```
2. Создайте файл .env в корневой папке (на основе .env.example) и укажите ваши данные:

API_TOKEN — токен вашего бота из @BotFather.

USER_ID — ваш цифровой ID из @userinfobot.

3. Запуск скриптов
Валидация почты: Проверяет наличие MX-записей и выполняет SMTP-handshake.

``` Bash
python mail_checker.py
```
Telegram-уведомления: Отправляет содержимое файла message.txt в чат.

``` Bash
python tg_bot.py
```
## 2. Архитектура системы на 1200+ email-аккаунтов
Система строится вокруг центрального управляющего сервиса на Python. Основная задача — не вычисления, а интеллектуальное планирование и распределение задач. Архитектура является модульной и "безсостояний" (stateless), что позволяет легко поддерживать её небольшой командой. Центральный узел координирует работу очередей, следит за ротацией аккаунтов и соблюдением жестких лимитов почтовых провайдеров.

### Какие сервисы и подходы используются

Backend: Python (FastAPI / asyncio) для быстрой обработки сетевых запросов.

Базы данных: PostgreSQL используется для хранения долгосрочных данных (клиенты, кампании, настройки аккаунтов). Redis применяется для оперативного хранения состояний, счетчиков лимитов и текущих сессий.

Очереди задач: Redis в связке с Celery или RQ для асинхронной обработки отправки писем.

Инфраструктура: Развертывание в Docker-контейнерах на 1–2 виртуальных серверах (VPS). Работа с почтой идет через прямые SMTP-подключения к Gmail, Outlook и другим провайдерам.

### Как работает ротация и мониторинг
Менеджер ротации — это «мозг» системы. Для каждого письма он подбирает активный аккаунт, у которого не исчерпан лимит. Мониторинг реализован через отслеживание статусов аккаунтов (active, warming, paused, blocked). Если при отправке возникают ошибки SMTP или срабатывают фильтры провайдера, система автоматически переводит аккаунт в статус paused и исключает его из ротации. Уведомления о критических сбоях приходят мгновенно через Telegram-бота.

### Как распределяется нагрузка
Вся отправка идет через очередь задач. Специальные воркеры (отправители) забирают задачи из очереди и выполняют их, строго соблюдая тайминги. Нагрузку легко регулировать: можно увеличивать количество воркеров в часы пик или уменьшать их ночью. Это обеспечивает равномерную «человекоподобную» отправку и защищает сервера провайдеров от подозрений на спам-активность.

### Риски и способы их закрытия

Блокировка аккаунтов: Решается жестким соблюдением лимитов и автоматическим «прогревом» новых адресов.

Сбой сервиса: Благодаря stateless-архитектуре и очередям в Redis, данные не теряются. Контейнеры Docker автоматически перезапускаются при падении.

Потеря писем: Использование идемпотентных задач (повтор задачи не создает дубликат письма) и фиксация финального статуса каждой отправки в базе данных.

Рост базы: Система масштабируется горизонтально путем добавления новых воркеров или дополнительных VPS.

### Примерная оценка стоимости

Инфраструктура (2 VPS-сервера для отказоустойчивости): $20–40/мес.

Базы данных и очереди (Redis/PostgreSQL): $0 (размещаются на тех же VPS).

Telegram-бот и мониторинг: $0.

Итого: Примерно $30–50 в месяц за техническую часть (без учета стоимости аренды почтовых аккаунтов и доменов).

## 3. Мой AI-стек
В работе я использую комбинацию современных инструментов для ускорения разработки и контроля качества:

IDE: VS Code. Предпочитаю использовать веб-интерфейсы нейросетей для глубокого анализа логики.

Модели:

ChatGPT (GPT-4o): Для проектирования архитектуры и генерации базовых скриптов.

DeepSeek: Для поиска багов и оптимизации сложной логики.

Gemini: Для анализа документации и работы с актуальными API.

Принципы: Использую кастомные системные промпты для получения чистого, типизированного и асинхронного кода без лишнего "шума".

## 4. Структура проекта
mail_checker.py — модуль валидации email (DNS + SMTP).

tg_bot.py — асинхронный скрипт отправки сообщений.

message.txt — файл-источник текста для рассылки.

requirements.txt — список необходимых библиотек.

.env.example — пример конфигурационного файла.